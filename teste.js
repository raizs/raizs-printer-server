class Adcart{constructor(string){console.log("muda de novoooo PF"),this.clientSide=adcAuth,this.string=string,this.discount="",this.publisher_id="",this.cart={},this.fingerprint,this.URL="https://api.adcart.com.br",this.ipScript="",this.fingerPrintScript="",this.start();}start(){this.getDiscount(),this.ipScript=document.createElement("script"),this.fingerPrintScript=document.createElement("script"),this.fingerPrintScript.src="https://cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/1.6.1/fingerprint2.min.js",this.fingerPrintScript.style="display: none",this.fingerPrintScript.onload=this.getFingerPrint.bind(this),document.getElementsByTagName("head")[0].appendChild(this.fingerPrintScript),this.ipScript.src="https://www.l2.io/ip.js?var=myip",this.ipScript.type="text/javascript",this.ipScript.addEventListener("load",()=>{this.myip=myip;}),document.getElementsByTagName("head")[0].appendChild(this.ipScript);}getFingerPrint(){const setFingerPrint=this.setFingerPrint.bind(this);new Fingerprint2({excludeAvailableScreenResolution:!0,excludeScreenResolution:!0}).get(function(result){setFingerPrint(result);});}setFingerPrint(fp){this.fingerprint=fp;}getDiscount(){const decodeToken=this.decodeToken.bind(this);var splited=window.location.search.replace("?","").split("=");for(var i in splited)if("tv-token"==splited[i-1])return decodeToken(splited[i]);}decodeToken(token){const setValues=this.setValues.bind(this);var route=this.URL+"/api/v1/decode_token";fetch(route,{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({token:token})}).then(function(r){return r.json();}).then(function(res){return setValues(res,token);});}setValues(res,token){const updateCart=this.updateCart.bind(this);this.cart=res.data.cart,this.discount=res.data.discount,this.publisher_id=res.data.publisher_id,this.myip?updateCart(null,null,null,token):this.ipScript.addEventListener("load",()=>updateCart(null,null,null,token));}updateCart(userId,cart,email,token){const mapCartToApi=this.mapCartToApi.bind(this);this.myip?mapCartToApi(userId,cart,email,token):this.ipScript.addEventListener("load",()=>mapCartToApi(userId,cart,email,token));}mapCartToApi(userId,cart,email,token,purchased){const postCart=this.postCart.bind(this),{fingerprint:fingerprint,clientSide:clientSide}=this;var body={user_agent:navigator.userAgent,ip:myip,purchased:!1,advertiser_id:clientSide.advertiser_id,url:location.origin,fingerprint:fingerprint,purchased:!!purchased};return userId&&(body.store_buyer_id=userId),email&&(body.email=email),token&&(body.token=token),cart&&cart.length&&(body.items=cart),postCart(body);}postCart(data){var route=this.URL+"/api/v1/carts";fetch(route,{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(data)}).then(function(response){return response.json();}).catch(function(err){console.log(err);});}setCartPurchased(userId){const mapCartToApi=this.mapCartToApi.bind(this);this.myip?mapCartToApi(userId,null,null,null,!0):this.ipScript.addEventListener("load",()=>mapCartToApi(userId,null,null,null,!0));}convert(userId,orderId){const postConversion=this.postConversion.bind(this);this.myip?postConversion(userId,orderId):this.ipScript.addEventListener("load",()=>postConversion(userId,orderId));}postConversion(userId,orderId){const{fingerprint:fingerprint,clientSide:clientSide,publisher_id:publisher_id,myip:myip,URL:URL}=this;var data={type:"conversion",advertiser_id:clientSide.advertiser_id,store_buyer_id:userId,user_agent:navigator.userAgent,ip:myip,publisher_id:publisher_id,order_id:orderId};fetch(URL+"/api/v1/tracking/conversion",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(data)}).then(function(response){return response.json();}).catch(function(err){console.log(err);});}}